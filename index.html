<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schiffli Production Manager v21</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .status-pending { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); }
        .status-production { background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); }
        .status-complete { background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%); }
        .status-approved { background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%); }
        .status-quality-check { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); }
        .glass-effect { backdrop-filter: blur(10px); background: rgba(255, 255, 255, 0.9); }
        .animate-pulse-slow { animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        .notification { transform: translateX(100%); transition: transform 0.3s ease-in-out; }
        .notification.show { transform: translateX(0); }
        @media print {
            .no-print { display: none !important; }
            .print-only { display: block !important; }
            body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">

    <!-- Notification System -->
    <div id="notificationContainer" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl max-w-md w-full mx-4 shadow-2xl">
            <div class="p-6 border-b bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-t-xl">
                <h3 class="text-xl font-semibold text-center">Schiffli Production Manager</h3>
                <p class="text-sm text-blue-100 text-center mt-1">Version 21 - Enhanced Edition</p>
            </div>
            <div class="p-6">
                <form id="loginForm">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Mobile Number</label>
                            <input type="tel" id="mobileNumber" required placeholder="Enter 10-digit mobile number" 
                                   pattern="[0-9]{10}" maxlength="10" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                            <input type="password" id="password" required placeholder="Enter password" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                        </div>
                    </div>
                    <div class="mt-6">
                        <button type="submit" class="w-full px-4 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 font-medium transition-all transform hover:scale-105">Login</button>
                    </div>
                </form>
                <div class="mt-4 text-center">
                    <button onclick="showDemoCredentials()" class="text-sm text-blue-600 hover:text-blue-700 transition-colors">View Demo Credentials</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Demo Credentials Modal -->
    <div id="demoCredentialsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl max-w-lg w-full mx-4 shadow-2xl">
            <div class="p-6 border-b bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-t-xl">
                <h3 class="text-xl font-semibold">Demo Login Credentials</h3>
            </div>
            <div class="p-6">
                <div class="space-y-4">
                    <div class="p-4 bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg border border-blue-200">
                        <h4 class="font-medium text-blue-900">ğŸ”‘ CEO/Admin</h4>
                        <p class="text-sm text-blue-700">Mobile: 9876543210</p>
                        <p class="text-sm text-blue-700">Password: admin123</p>
                        <p class="text-xs text-blue-600 mt-1">Full access to all features</p>
                    </div>
                    <div class="p-4 bg-gradient-to-r from-green-50 to-green-100 rounded-lg border border-green-200">
                        <h4 class="font-medium text-green-900">ğŸ‘¨â€ğŸ’¼ Production Manager</h4>
                        <p class="text-sm text-green-700">Mobile: 9876543211</p>
                        <p class="text-sm text-green-700">Password: manager123</p>
                        <p class="text-xs text-green-600 mt-1">Production & workflow management</p>
                    </div>
                    <div class="p-4 bg-gradient-to-r from-yellow-50 to-yellow-100 rounded-lg border border-yellow-200">
                        <h4 class="font-medium text-yellow-900">âš™ï¸ Operator</h4>
                        <p class="text-sm text-yellow-700">Mobile: 9876543212</p>
                        <p class="text-sm text-yellow-700">Password: operator123</p>
                        <p class="text-xs text-yellow-600 mt-1">View orders & update status</p>
                    </div>
                    <div class="p-4 bg-gradient-to-r from-purple-50 to-purple-100 rounded-lg border border-purple-200">
                        <h4 class="font-medium text-purple-900">ğŸ” Quality Control</h4>
                        <p class="text-sm text-purple-700">Mobile: 9876543213</p>
                        <p class="text-sm text-purple-700">Password: qc123</p>
                        <p class="text-xs text-purple-600 mt-1">Quality checks & approvals</p>
                    </div>
                </div>
                <div class="mt-6 flex gap-4">
                    <button onclick="closeDemoCredentials()" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">Close</button>
                    <button onclick="fillDemoCredentials('admin')" class="flex-1 px-4 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all">Use Admin Login</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="glass-effect shadow-lg border-b border-white/20">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-lg flex items-center justify-center">
                        <span class="text-white font-bold text-lg">S</span>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent">Schiffli Production Manager</h1>
                        <p class="text-xs text-gray-600">Version 21 - Enhanced Edition</p>
                    </div>
                </div>
                <div class="flex gap-2 items-center flex-wrap">
                    <button onclick="showSection('dashboard')" id="dashboardBtn" class="nav-btn px-4 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 text-sm transition-all transform hover:scale-105">ğŸ“Š Dashboard</button>
                    <button onclick="showSection('analytics')" id="analyticsBtn" class="nav-btn px-4 py-2 text-gray-600 hover:bg-white/50 rounded-lg text-sm transition-all">ğŸ“ˆ Analytics</button>
                    <button onclick="showSection('production')" id="productionBtn" class="nav-btn px-4 py-2 text-gray-600 hover:bg-white/50 rounded-lg text-sm transition-all">âš™ï¸ Production</button>
                    <button onclick="showSection('workflow')" id="workflowBtn" class="nav-btn px-4 py-2 text-gray-600 hover:bg-white/50 rounded-lg text-sm transition-all">ğŸ”„ Workflow</button>
                    <button onclick="showSection('orders')" id="ordersBtn" class="nav-btn px-4 py-2 text-gray-600 hover:bg-white/50 rounded-lg text-sm transition-all">ğŸ“‹ Orders</button>
                    <button onclick="showSection('newOrder')" id="newOrderBtn" class="nav-btn px-4 py-2 text-gray-600 hover:bg-white/50 rounded-lg text-sm transition-all">â• New Order</button>
                    <button onclick="showSection('users')" id="usersBtn" class="nav-btn px-4 py-2 text-gray-600 hover:bg-white/50 rounded-lg text-sm transition-all">ğŸ‘¥ Users</button>
                    
                    <!-- User Profile -->
                    <div class="flex items-center gap-3 ml-4 pl-4 border-l border-gray-300">
                        <div class="text-right">
                            <p id="userDisplayName" class="text-sm font-medium text-gray-900">User</p>
                            <p id="userRole" class="text-xs text-gray-600">Role</p>
                        </div>
                        <div class="relative">
                            <button onclick="toggleUserMenu()" class="w-10 h-10 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-full flex items-center justify-center text-sm font-medium hover:from-blue-700 hover:to-indigo-700 transition-all transform hover:scale-105">
                                <span id="userInitials">U</span>
                            </button>
                            <div id="userMenu" class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-xl border hidden z-50">
                                <div class="p-3 border-b bg-gradient-to-r from-blue-50 to-indigo-50">
                                    <p class="text-sm font-medium text-gray-900" id="menuUserName">User</p>
                                    <p class="text-xs text-gray-600" id="menuUserMobile">Mobile</p>
                                </div>
                                <div class="py-1">
                                    <button onclick="logout()" class="w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors">ğŸšª Logout</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Dashboard Section -->
    <div id="dashboardSection" class="max-w-7xl mx-auto px-6 py-8 hidden">
        <div class="flex justify-between items-center mb-8">
            <h2 class="text-3xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent">Production Dashboard</h2>
            <div class="text-sm text-gray-600">
                <span id="currentDateTime" class="animate-pulse-slow"></span>
            </div>
        </div>
        
        <!-- Enhanced Stats Cards -->
        <div class="grid md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-lg border border-white/20 hover:shadow-xl transition-all transform hover:scale-105">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm font-medium">Total Orders</p>
                        <p id="totalOrders" class="text-3xl font-bold text-gray-900">0</p>
                        <p class="text-xs text-green-600 mt-1">ğŸ“ˆ Ready for growth</p>
                    </div>
                    <div class="w-14 h-14 bg-gradient-to-r from-blue-100 to-indigo-100 rounded-xl flex items-center justify-center">
                        <span class="text-blue-600 text-2xl">ğŸ“‹</span>
                    </div>
                </div>
            </div>
            
            <div class="bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-lg border border-white/20 hover:shadow-xl transition-all transform hover:scale-105">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm font-medium">In Production</p>
                        <p id="inProductionCount" class="text-3xl font-bold text-blue-600">0</p>
                        <p class="text-xs text-blue-600 mt-1">âš™ï¸ Machines ready</p>
                    </div>
                    <div class="w-14 h-14 bg-gradient-to-r from-blue-100 to-blue-200 rounded-xl flex items-center justify-center">
                        <span class="text-blue-600 text-2xl">âš™ï¸</span>
                    </div>
                </div>
            </div>
            
            <div class="bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-lg border border-white/20 hover:shadow-xl transition-all transform hover:scale-105">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm font-medium">Completed</p>
                        <p id="completedCount" class="text-3xl font-bold text-green-600">0</p>
                        <p class="text-xs text-green-600 mt-1">âœ… Perfect start</p>
                    </div>
                    <div class="w-14 h-14 bg-gradient-to-r from-green-100 to-green-200 rounded-xl flex items-center justify-center">
                        <span class="text-green-600 text-2xl">âœ…</span>
                    </div>
                </div>
            </div>
            
            <div class="bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-lg border border-white/20 hover:shadow-xl transition-all transform hover:scale-105">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm font-medium">Efficiency</p>
                        <p id="overallEfficiency" class="text-3xl font-bold text-purple-600">100%</p>
                        <p class="text-xs text-purple-600 mt-1">ğŸš€ Optimized</p>
                    </div>
                    <div class="w-14 h-14 bg-gradient-to-r from-purple-100 to-purple-200 rounded-xl flex items-center justify-center">
                        <span class="text-purple-600 text-2xl">ğŸ“Š</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="grid md:grid-cols-3 gap-6 mb-8">
            <div class="bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-lg border border-white/20">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">ğŸš€ Quick Actions</h3>
                <div class="space-y-3">
                    <button onclick="showSection('newOrder')" class="w-full px-4 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all transform hover:scale-105">â• Create New Order</button>
                    <button onclick="showSection('orders')" class="w-full px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all">ğŸ“‹ View All Orders</button>
                    <button onclick="showSection('production')" class="w-full px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all">âš™ï¸ Production Status</button>
                </div>
            </div>
            
            <div class="bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-lg border border-white/20">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">ğŸ“Š Today's Summary</h3>
                <div class="space-y-3">
                    <div class="flex justify-between">
                        <span class="text-gray-600">Orders Created:</span>
                        <span class="font-semibold" id="todayOrders">0</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Orders Completed:</span>
                        <span class="font-semibold" id="todayCompleted">0</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Production Time:</span>
                        <span class="font-semibold" id="todayProductionTime">0h</span>
                    </div>
                </div>
            </div>
            
            <div class="bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-lg border border-white/20">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">ğŸ¯ System Status</h3>
                <div class="space-y-3">
                    <div class="flex items-center justify-between">
                        <span class="text-gray-600">Database:</span>
                        <span class="px-2 py-1 bg-green-100 text-green-800 rounded text-xs">ğŸŸ¢ Online</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-gray-600">Machines:</span>
                        <span class="px-2 py-1 bg-green-100 text-green-800 rounded text-xs">ğŸŸ¢ Ready</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-gray-600">Version:</span>
                        <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs">v21</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Orders -->
        <div class="bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-white/20">
            <div class="p-6 border-b border-gray-200">
                <h3 class="text-lg font-semibold text-gray-900">ğŸ“‹ Recent Orders</h3>
            </div>
            <div id="recentOrdersList" class="p-6">
                <div class="text-center py-12">
                    <div class="w-16 h-16 bg-gradient-to-r from-blue-100 to-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-blue-600 text-2xl">ğŸ“‹</span>
                    </div>
                    <p class="text-gray-500 text-lg font-medium">No orders yet</p>
                    <p class="text-gray-400 text-sm mt-1">Create your first order to get started!</p>
                    <button onclick="showSection('newOrder')" class="mt-4 px-6 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all transform hover:scale-105">â• Create First Order</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Analytics Section -->
    <div id="analyticsSection" class="max-w-7xl mx-auto px-6 py-8 hidden">
        <h2 class="text-3xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent mb-8">ğŸ“ˆ Analytics & Reports</h2>
        
        <div class="grid md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-lg border border-white/20">
                <h3 class="text-sm font-medium text-gray-600 mb-2">Production Efficiency</h3>
                <p class="text-3xl font-bold text-gray-900">100%</p>
                <p class="text-xs text-green-600">ğŸš€ Perfect start - Ready for data</p>
            </div>
            
            <div class="bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-lg border border-white/20">
                <h3 class="text-sm font-medium text-gray-600 mb-2">Average Order Time</h3>
                <p class="text-3xl font-bold text-gray-900">0 days</p>
                <p class="text-xs text-blue-600">â±ï¸ Start creating orders</p>
            </div>
            
            <div class="bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-lg border border-white/20">
                <h3 class="text-sm font-medium text-gray-600 mb-2">Machine Utilization</h3>
                <p class="text-3xl font-bold text-gray-900">0%</p>
                <p class="text-xs text-yellow-600">âš™ï¸ Ready for production</p>
            </div>
            
            <div class="bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-lg border border-white/20">
                <h3 class="text-sm font-medium text-gray-600 mb-2">Quality Score</h3>
                <p class="text-3xl font-bold text-gray-900">100%</p>
                <p class="text-xs text-green-600">âœ… Perfect quality</p>
            </div>
        </div>

        <div class="bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-white/20 p-8">
            <h3 class="text-xl font-semibold text-gray-900 mb-6">ğŸ“Š Analytics Dashboard</h3>
            <div class="text-center py-12">
                <div class="w-20 h-20 bg-gradient-to-r from-blue-100 to-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <span class="text-blue-600 text-3xl">ğŸ“ˆ</span>
                </div>
                <p class="text-gray-600 text-lg">Analytics will populate as you create and manage orders</p>
                <p class="text-gray-500 text-sm mt-2">Start by creating your first order to see detailed analytics!</p>
                <button onclick="showSection('newOrder')" class="mt-6 px-6 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all transform hover:scale-105">â• Create First Order</button>
            </div>
        </div>
    </div>

    <!-- Production Section -->
    <div id="productionSection" class="max-w-7xl mx-auto px-6 py-8 hidden">
        <h2 class="text-3xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent mb-8">âš™ï¸ Production Management</h2>
        
        <div class="grid md:grid-cols-2 gap-6 mb-8">
            <div class="bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-white/20">
                <div class="p-6 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-t-xl">
                    <h3 class="text-lg font-semibold text-gray-900">ğŸ­ Machine Status</h3>
                </div>
                <div class="p-6">
                    <div id="machineStatusList" class="space-y-4">
                        <!-- Machine status will be populated dynamically -->
                    </div>
                </div>
            </div>
            
            <div class="bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-white/20">
                <div class="p-6 border-b border-gray-200 bg-gradient-to-r from-purple-50 to-violet-50 rounded-t-xl">
                    <h3 class="text-lg font-semibold text-gray-900">ğŸ“Š Production Estimates</h3>
                </div>
                <div class="p-6">
                    <div id="productionEstimates" class="space-y-4">
                        <!-- Production estimates will be populated dynamically -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Workflow Section -->
    <div id="workflowSection" class="max-w-7xl mx-auto px-6 py-8 hidden">
        <h2 class="text-3xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent mb-8">ğŸ”„ Workflow Management</h2>
        
        <div class="grid md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-lg border border-white/20 text-center hover:shadow-xl transition-all transform hover:scale-105">
                <div class="w-16 h-16 bg-gradient-to-r from-yellow-100 to-orange-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <span class="text-yellow-600 text-2xl">â³</span>
                </div>
                <h3 class="font-semibold text-gray-900">Pending Approval</h3>
                <p id="workflowPending" class="text-3xl font-bold text-yellow-600">0</p>
                <p class="text-xs text-yellow-600 mt-1">Ready for review</p>
            </div>
            
            <div class="bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-lg border border-white/20 text-center hover:shadow-xl transition-all transform hover:scale-105">
                <div class="w-16 h-16 bg-gradient-to-r from-blue-100 to-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <span class="text-blue-600 text-2xl">âœ…</span>
                </div>
                <h3 class="font-semibold text-gray-900">Approved</h3>
                <p id="workflowApproved" class="text-3xl font-bold text-blue-600">0</p>
                <p class="text-xs text-blue-600 mt-1">Ready for production</p>
            </div>
            
            <div class="bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-lg border border-white/20 text-center hover:shadow-xl transition-all transform hover:scale-105">
                <div class="w-16 h-16 bg-gradient-to-r from-orange-100 to-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <span class="text-orange-600 text-2xl">ğŸ”</span>
                </div>
                <h3 class="font-semibold text-gray-900">Quality Check</h3>
                <p id="workflowQuality" class="text-3xl font-bold text-orange-600">0</p>
                <p class="text-xs text-orange-600 mt-1">Under inspection</p>
            </div>
            
            <div class="bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-lg border border-white/20 text-center hover:shadow-xl transition-all transform hover:scale-105">
                <div class="w-16 h-16 bg-gradient-to-r from-green-100 to-emerald-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <span class="text-green-600 text-2xl">ğŸ“¦</span>
                </div>
                <h3 class="font-semibold text-gray-900">Ready for Delivery</h3>
                <p id="workflowComplete" class="text-3xl font-bold text-green-600">0</p>
                <p class="text-xs text-green-600 mt-1">Completed orders</p>
            </div>
        </div>

        <div class="bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-white/20">
            <div class="p-6 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-t-xl">
                <h3 class="text-lg font-semibold text-gray-900">ğŸ”„ Current Workflow Orders</h3>
            </div>
            <div id="workflowOrdersList" class="p-6">
                <div class="text-center py-12">
                    <div class="w-16 h-16 bg-gradient-to-r from-blue-100 to-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-blue-600 text-2xl">ğŸ”„</span>
                    </div>
                    <p class="text-gray-500 text-lg font-medium">No orders in workflow yet</p>
                    <p class="text-gray-400 text-sm mt-1">Create your first order to see it here!</p>
                    <button onclick="showSection('newOrder')" class="mt-4 px-6 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all transform hover:scale-105">â• Create First Order</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Orders Section -->
    <div id="ordersSection" class="max-w-7xl mx-auto px-6 py-8 hidden">
        <h2 class="text-3xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent mb-8">ğŸ“‹ Production Orders</h2>
        
        <!-- Enhanced Filter Buttons -->
        <div class="flex gap-2 mb-6 flex-wrap">
            <button onclick="filterOrders('all')" id="filterAll" class="px-4 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 text-sm transition-all transform hover:scale-105">ğŸ“‹ All Orders</button>
            <button onclick="filterOrders('pending-approval')" id="filterPending" class="px-4 py-2 bg-white/80 text-gray-700 rounded-lg hover:bg-white border border-gray-200 text-sm transition-all">â³ Pending</button>
            <button onclick="filterOrders('production')" id="filterProduction" class="px-4 py-2 bg-white/80 text-gray-700 rounded-lg hover:bg-white border border-gray-200 text-sm transition-all">âš™ï¸ Production</button>
            <button onclick="filterOrders('quality-check')" id="filterQuality" class="px-4 py-2 bg-white/80 text-gray-700 rounded-lg hover:bg-white border border-gray-200 text-sm transition-all">ğŸ” Quality</button>
            <button onclick="filterOrders('complete')" id="filterComplete" class="px-4 py-2 bg-white/80 text-gray-700 rounded-lg hover:bg-white border border-gray-200 text-sm transition-all">âœ… Complete</button>
        </div>
        
        <div class="bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-white/20">
            <div class="p-6 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-t-xl">
                <h3 class="text-lg font-semibold text-gray-900">ğŸ“Š Order Management</h3>
            </div>
            <div id="ordersList" class="p-6">
                <div class="text-center py-12">
                    <div class="w-16 h-16 bg-gradient-to-r from-blue-100 to-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-blue-600 text-2xl">ğŸ“‹</span>
                    </div>
                    <p class="text-gray-500 text-lg font-medium">No orders found</p>
                    <p class="text-gray-400 text-sm mt-1">Create your first order to get started!</p>
                    <button onclick="showSection('newOrder')" class="mt-4 px-6 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all transform hover:scale-105">â• Create First Order</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced New Order Section -->
    <div id="newOrderSection" class="max-w-4xl mx-auto px-6 py-8 hidden">
        <h2 class="text-3xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent mb-8">â• Create New Order</h2>
        
        <form id="orderForm" class="bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-white/20 p-8">
            <div class="grid md:grid-cols-2 gap-8">
                <!-- Order Details -->
                <div class="space-y-6">
                    <div class="pb-4 border-b border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-900 flex items-center">
                            ğŸ“‹ Order Details
                        </h3>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Order ID</label>
                        <input type="text" id="orderId" class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-50 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" readonly>
                        <p class="text-xs text-gray-500 mt-1">Auto-generated unique ID</p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Customer Name *</label>
                        <input type="text" id="customerName" required placeholder="Enter customer name" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Design Number *</label>
                        <input type="text" id="designNumber" required placeholder="e.g., DSN-001" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Meters to Produce *</label>
                        <input type="number" id="metersCount" required min="1" placeholder="Enter meters" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                    </div>
                </div>

                <!-- Fabric Details -->
                <div class="space-y-6">
                    <div class="pb-4 border-b border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-900 flex items-center">
                            ğŸ§µ Fabric & Production
                        </h3>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Fabric Type *</label>
                        <select id="fabricType" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                            <option value="">Select Fabric Type</option>
                            <option value="Cotton">Cotton</option>
                            <option value="Polyester">Polyester</option>
                            <option value="Silk">Silk</option>
                            <option value="Linen">Linen</option>
                            <option value="Blend">Cotton-Polyester Blend</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Fabric Color *</label>
                        <input type="text" id="fabricColor" required placeholder="e.g., White, Blue, Red" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Embroidery Placement *</label>
                        <select id="embroideryPlacement" required onchange="handlePlacementChange()" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                            <option value="">Select Placement</option>
                            <option value="Front">Front</option>
                            <option value="Back">Back</option>
                            <option value="Sleeve">Sleeve</option>
                            <option value="Chest">Chest</option>
                            <option value="All-Over">All-Over Pattern</option>
                            <option value="Collar">Collar</option>
                            <option value="Pocket">Pocket</option>
                            <option value="Hem">Hem</option>
                            <option value="custom">ğŸ¯ Custom Placement</option>
                        </select>
                        <div id="customPlacementDiv" class="mt-3 hidden">
                            <input type="text" id="customPlacement" placeholder="Enter custom placement (e.g., Left Shoulder, Right Cuff)" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                            <p class="text-xs text-gray-500 mt-1">Specify exact placement location for embroidery</p>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Repeat Size *</label>
                        <input type="text" id="repeatSize" required placeholder="e.g., 10cm x 15cm" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Yarn Code *</label>
                        <input type="text" id="yarnCode" required placeholder="e.g., YC-001, YC-002" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Design Image</label>
                        <input type="file" id="designImage" accept="image/*" onchange="handleImageUpload(this)" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                        <p class="text-xs text-gray-500 mt-1">Upload design image (JPG, PNG, GIF)</p>
                        <div id="imagePreview" class="mt-3 hidden">
                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-4">
                                <img id="previewImg" src="" alt="Design Preview" class="w-32 h-32 object-cover border rounded-lg mx-auto">
                                <p class="text-xs text-gray-500 text-center mt-2">Design Preview</p>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Assigned Machine *</label>
                        <input type="text" id="assignedMachine" required placeholder="Enter machine name (e.g., Machine-01)" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                        <p class="text-xs text-gray-500 mt-1">Manually enter the machine to be assigned for this order</p>
                    </div>
                </div>
            </div>
            
            <div class="flex gap-4 mt-8 pt-6 border-t border-gray-200">
                <button type="submit" class="px-8 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 font-medium transition-all transform hover:scale-105">âœ… Create Order</button>
                <button type="button" onclick="resetOrderForm()" class="px-8 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-all">ğŸ”„ Reset Form</button>
            </div>
        </form>
    </div>

    <!-- Users Management Section -->
    <div id="usersSection" class="max-w-7xl mx-auto px-6 py-8 hidden">
        <div class="flex justify-between items-center mb-8">
            <h2 class="text-3xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent">ğŸ‘¥ User Management</h2>
            <button onclick="showAddUserModal()" class="px-6 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all transform hover:scale-105">â• Add New User</button>
        </div>

        <!-- User Statistics -->
        <div class="grid md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-lg border border-white/20 hover:shadow-xl transition-all transform hover:scale-105">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm font-medium">Total Users</p>
                        <p id="totalUsers" class="text-3xl font-bold text-gray-900">1</p>
                        <p class="text-xs text-blue-600 mt-1">ğŸ‘¥ Ready to grow</p>
                    </div>
                    <div class="w-14 h-14 bg-gradient-to-r from-blue-100 to-indigo-100 rounded-xl flex items-center justify-center">
                        <span class="text-blue-600 text-2xl">ğŸ‘¥</span>
                    </div>
                </div>
            </div>
            
            <div class="bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-lg border border-white/20 hover:shadow-xl transition-all transform hover:scale-105">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm font-medium">Admins</p>
                        <p id="adminCount" class="text-3xl font-bold text-red-600">1</p>
                        <p class="text-xs text-red-600 mt-1">ğŸ”‘ Full access</p>
                    </div>
                    <div class="w-14 h-14 bg-gradient-to-r from-red-100 to-red-200 rounded-xl flex items-center justify-center">
                        <span class="text-red-600 text-2xl">ğŸ”‘</span>
                    </div>
                </div>
            </div>
            
            <div class="bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-lg border border-white/20 hover:shadow-xl transition-all transform hover:scale-105">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm font-medium">Managers</p>
                        <p id="managerCount" class="text-3xl font-bold text-green-600">0</p>
                        <p class="text-xs text-green-600 mt-1">ğŸ‘¨â€ğŸ’¼ Add production leads</p>
                    </div>
                    <div class="w-14 h-14 bg-gradient-to-r from-green-100 to-green-200 rounded-xl flex items-center justify-center">
                        <span class="text-green-600 text-2xl">ğŸ‘¨â€ğŸ’¼</span>
                    </div>
                </div>
            </div>
            
            <div class="bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-lg border border-white/20 hover:shadow-xl transition-all transform hover:scale-105">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm font-medium">Staff</p>
                        <p id="staffCount" class="text-3xl font-bold text-purple-600">0</p>
                        <p class="text-xs text-purple-600 mt-1">âš™ï¸ Add team members</p>
                    </div>
                    <div class="w-14 h-14 bg-gradient-to-r from-purple-100 to-purple-200 rounded-xl flex items-center justify-center">
                        <span class="text-purple-600 text-2xl">âš™ï¸</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Users List -->
        <div class="bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-white/20">
            <div class="p-6 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-t-xl">
                <h3 class="text-lg font-semibold text-gray-900">ğŸ‘¥ All Users</h3>
            </div>
            <div id="usersList" class="p-6">
                <!-- Users will be populated here -->
            </div>
        </div>
    </div>

    <!-- Edit Order Modal -->
    <div id="editOrderModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-t-xl">
                <h3 class="text-xl font-semibold">âœï¸ Edit Order</h3>
            </div>
            <div class="p-6">
                <form id="editOrderForm">
                    <input type="hidden" id="editOrderId">
                    <div class="grid md:grid-cols-2 gap-8">
                        <!-- Order Details -->
                        <div class="space-y-6">
                            <div class="pb-4 border-b border-gray-200">
                                <h3 class="text-lg font-semibold text-gray-900 flex items-center">ğŸ“‹ Order Details</h3>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Customer Name *</label>
                                <input type="text" id="editCustomerName" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Design Number *</label>
                                <input type="text" id="editDesignNumber" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Meters to Produce *</label>
                                <input type="number" id="editMetersCount" required min="1" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                            </div>
                        </div>

                        <!-- Fabric Details -->
                        <div class="space-y-6">
                            <div class="pb-4 border-b border-gray-200">
                                <h3 class="text-lg font-semibold text-gray-900 flex items-center">ğŸ§µ Fabric & Production</h3>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Fabric Type *</label>
                                <select id="editFabricType" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                                    <option value="">Select Fabric Type</option>
                                    <option value="Cotton">Cotton</option>
                                    <option value="Polyester">Polyester</option>
                                    <option value="Silk">Silk</option>
                                    <option value="Linen">Linen</option>
                                    <option value="Blend">Cotton-Polyester Blend</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Fabric Color *</label>
                                <input type="text" id="editFabricColor" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Embroidery Placement *</label>
                                <select id="editEmbroideryPlacement" required onchange="handleEditPlacementChange()" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                                    <option value="">Select Placement</option>
                                    <option value="Front">Front</option>
                                    <option value="Back">Back</option>
                                    <option value="Sleeve">Sleeve</option>
                                    <option value="Chest">Chest</option>
                                    <option value="All-Over">All-Over Pattern</option>
                                    <option value="Collar">Collar</option>
                                    <option value="Pocket">Pocket</option>
                                    <option value="Hem">Hem</option>
                                    <option value="custom">ğŸ¯ Custom Placement</option>
                                </select>
                                <div id="editCustomPlacementDiv" class="mt-3 hidden">
                                    <input type="text" id="editCustomPlacement" placeholder="Enter custom placement" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Repeat Size *</label>
                                <input type="text" id="editRepeatSize" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Yarn Code *</label>
                                <input type="text" id="editYarnCode" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Assigned Machine *</label>
                                <input type="text" id="editAssignedMachine" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex gap-4 mt-8 pt-6 border-t border-gray-200">
                        <button type="submit" class="px-8 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 font-medium transition-all transform hover:scale-105">âœ… Update Order</button>
                        <button type="button" onclick="closeEditOrderModal()" class="px-8 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-all">âŒ Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Job Card Print Modal -->
    <div id="jobCardModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl max-w-6xl w-full mx-4 shadow-2xl max-h-[95vh] overflow-y-auto">
            <div class="p-6 border-b bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-t-xl no-print">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-semibold">ğŸ–¨ï¸ Job Card Preview</h3>
                    <div class="flex gap-3">
                        <button onclick="downloadJobCardPDF()" class="px-4 py-2 bg-white/20 text-white rounded-lg hover:bg-white/30 transition-all">ğŸ“„ Save PDF</button>
                        <button onclick="printJobCardNow()" class="px-4 py-2 bg-white/20 text-white rounded-lg hover:bg-white/30 transition-all">ğŸ–¨ï¸ Print</button>
                        <button onclick="closeJobCardModal()" class="px-4 py-2 bg-white/20 text-white rounded-lg hover:bg-white/30 transition-all">âŒ Close</button>
                    </div>
                </div>
            </div>
            
            <!-- A4 Job Card Template -->
            <div id="jobCardContent" class="bg-white" style="width: 210mm; min-height: 297mm; margin: 0 auto; padding: 20mm; box-sizing: border-box;">
                <!-- Job card content will be populated here -->
            </div>
        </div>
    </div>

    <!-- Add User Modal -->
    <div id="addUserModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl max-w-2xl w-full mx-4 shadow-2xl">
            <div class="p-6 border-b bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-t-xl">
                <h3 class="text-xl font-semibold">â• Add New User</h3>
            </div>
            <div class="p-6">
                <form id="addUserForm">
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Full Name *</label>
                            <input type="text" id="newUserName" required placeholder="Enter full name" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Mobile Number *</label>
                            <input type="tel" id="newUserMobile" required placeholder="7292XXXXXXX" pattern="7292[0-9]{6}" maxlength="10" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                            <p class="text-xs text-gray-500 mt-1">Must start with 7292</p>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Password *</label>
                            <input type="password" id="newUserPassword" required placeholder="Enter password" minlength="6" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Role *</label>
                            <select id="newUserRole" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                                <option value="">Select Role</option>
                                <option value="admin">ğŸ”‘ Admin - Full Access</option>
                                <option value="manager">ğŸ‘¨â€ğŸ’¼ Manager - Production & Workflow</option>
                                <option value="operator">âš™ï¸ Operator - View & Update Orders</option>
                                <option value="qc">ğŸ” Quality Control - Quality Checks</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Department *</label>
                            <select id="newUserDepartment" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                                <option value="">Select Department</option>
                                <option value="Management">Management</option>
                                <option value="Production">Production</option>
                                <option value="Quality">Quality Control</option>
                                <option value="Operations">Operations</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                            <select id="newUserStatus" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                                <option value="active">ğŸŸ¢ Active</option>
                                <option value="inactive">ğŸ”´ Inactive</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Permissions Section -->
                    <div class="mt-6">
                        <h4 class="text-lg font-semibold text-gray-900 mb-4">ğŸ” Permissions</h4>
                        <div id="permissionsSection" class="grid md:grid-cols-2 gap-4">
                            <!-- Permissions will be populated based on role selection -->
                        </div>
                    </div>
                    
                    <div class="flex gap-4 mt-8 pt-6 border-t border-gray-200">
                        <button type="submit" class="px-8 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 font-medium transition-all transform hover:scale-105">âœ… Create User</button>
                        <button type="button" onclick="closeAddUserModal()" class="px-8 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-all">âŒ Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let orders = [];
        let dailyCounter = {};
        let currentUser = null;
        
        // User roles and permissions
        const userRoles = {
            admin: {
                name: 'Admin',
                permissions: ['all', 'manage_users', 'view_all', 'manage_production', 'manage_workflow', 'create_orders', 'approve_orders', 'quality_check', 'approve_quality', 'update_status'],
                sections: ['dashboard', 'analytics', 'production', 'workflow', 'orders', 'newOrder', 'users']
            },
            manager: {
                name: 'Production Manager',
                permissions: ['view_all', 'manage_production', 'manage_workflow', 'create_orders', 'approve_orders'],
                sections: ['dashboard', 'analytics', 'production', 'workflow', 'orders', 'newOrder']
            },
            operator: {
                name: 'Operator',
                permissions: ['view_orders', 'update_status'],
                sections: ['dashboard', 'orders']
            },
            qc: {
                name: 'Quality Control',
                permissions: ['view_orders', 'quality_check', 'approve_quality'],
                sections: ['dashboard', 'workflow', 'orders']
            }
        };
        
        // Users array - starts empty, only login user exists
        const users = [
            {
                id: 'user_1',
                name: 'Admin User',
                mobile: '9876543210',
                password: 'admin123',
                role: 'admin',
                department: 'Management',
                status: 'active',
                createdDate: '2024-01-01',
                permissions: ['all', 'manage_users', 'view_all', 'manage_production', 'manage_workflow', 'create_orders', 'approve_orders', 'quality_check', 'approve_quality', 'update_status']
            }
        ];
        
        // Notification system
        function showNotification(message, type = 'success') {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            
            const bgColor = type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-blue-500';
            const icon = type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : 'â„¹ï¸';
            
            notification.className = `notification ${bgColor} text-white px-6 py-4 rounded-lg shadow-lg flex items-center space-x-3 max-w-sm`;
            notification.innerHTML = `
                <span class="text-lg">${icon}</span>
                <span class="font-medium">${message}</span>
            `;
            
            container.appendChild(notification);
            
            // Show notification
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            // Hide notification after 3 seconds
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    container.removeChild(notification);
                }, 300);
            }, 3000);
        }
        
        // Update current date/time
        function updateDateTime() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            const dateTimeElement = document.getElementById('currentDateTime');
            if (dateTimeElement) {
                dateTimeElement.textContent = now.toLocaleDateString('en-US', options);
            }
        }
        
        // Authentication functions
        function authenticateUser(mobile, password) {
            const user = users.find(u => u.mobile === mobile && u.password === password);
            if (user) {
                currentUser = { ...user };
                return true;
            }
            return false;
        }
        
        function canAccessSection(section) {
            if (!currentUser) return false;
            const role = userRoles[currentUser.role];
            return role && role.sections.includes(section);
        }
        
        function updateUserInterface() {
            if (!currentUser) return;
            
            // Update user display
            document.getElementById('userDisplayName').textContent = currentUser.name;
            document.getElementById('userRole').textContent = userRoles[currentUser.role].name;
            document.getElementById('userInitials').textContent = currentUser.name.split(' ').map(n => n[0]).join('').toUpperCase();
            document.getElementById('menuUserName').textContent = currentUser.name;
            document.getElementById('menuUserMobile').textContent = currentUser.mobile;
            
            // Show/hide navigation buttons based on permissions
            const navButtons = document.querySelectorAll('.nav-btn');
            navButtons.forEach(btn => {
                const section = btn.id.replace('Btn', '');
                if (!canAccessSection(section)) {
                    btn.style.display = 'none';
                } else {
                    btn.style.display = 'inline-block';
                }
            });
        }
        
        // User Management Functions
        window.showAddUserModal = function() {
            if (!currentUser || !userRoles[currentUser.role].permissions.includes('manage_users')) {
                showNotification('Access denied. Only admins can manage users.', 'error');
                return;
            }
            document.getElementById('addUserModal').classList.remove('hidden');
            document.getElementById('addUserModal').classList.add('flex');
            setupPermissionsSection();
        }
        
        window.closeAddUserModal = function() {
            document.getElementById('addUserModal').classList.add('hidden');
            document.getElementById('addUserModal').classList.remove('flex');
            document.getElementById('addUserForm').reset();
        }
        
        function setupPermissionsSection() {
            const roleSelect = document.getElementById('newUserRole');
            const permissionsSection = document.getElementById('permissionsSection');
            
            // All available permissions
            const allPermissions = [
                { id: 'view_all', name: 'View All Data', description: 'Access to view all system data' },
                { id: 'manage_users', name: 'Manage Users', description: 'Create, edit, and delete users' },
                { id: 'manage_production', name: 'Manage Production', description: 'Control production processes' },
                { id: 'manage_workflow', name: 'Manage Workflow', description: 'Control workflow stages' },
                { id: 'create_orders', name: 'Create Orders', description: 'Create new production orders' },
                { id: 'approve_orders', name: 'Approve Orders', description: 'Approve pending orders' },
                { id: 'quality_check', name: 'Quality Check', description: 'Perform quality inspections' },
                { id: 'approve_quality', name: 'Approve Quality', description: 'Approve quality checks' },
                { id: 'update_status', name: 'Update Status', description: 'Update order status' },
                { id: 'view_orders', name: 'View Orders', description: 'View order information' }
            ];
            
            roleSelect.addEventListener('change', function() {
                const selectedRole = this.value;
                if (selectedRole && userRoles[selectedRole]) {
                    const defaultPermissions = userRoles[selectedRole].permissions;
                    let html = '<div class="space-y-3">';
                    
                    allPermissions.forEach(permission => {
                        const isChecked = defaultPermissions.includes(permission.id) || defaultPermissions.includes('all');
                        const isDisabled = permission.id === 'all' && selectedRole === 'admin';
                        
                        html += `
                            <div class="flex items-start p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                                <input type="checkbox" 
                                       id="perm_${permission.id}" 
                                       name="permissions" 
                                       value="${permission.id}"
                                       ${isChecked ? 'checked' : ''}
                                       ${isDisabled ? 'disabled' : ''}
                                       class="mt-1 mr-3 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <div class="flex-1">
                                    <label for="perm_${permission.id}" class="text-sm font-medium text-gray-900 cursor-pointer">
                                        ${permission.name}
                                    </label>
                                    <p class="text-xs text-gray-600 mt-1">${permission.description}</p>
                                </div>
                            </div>
                        `;
                    });
                    
                    // Add admin full access note
                    if (selectedRole === 'admin') {
                        html += `
                            <div class="p-3 bg-blue-50 border border-blue-200 rounded-lg">
                                <p class="text-sm text-blue-800 font-medium">ğŸ”‘ Admin Role</p>
                                <p class="text-xs text-blue-600 mt-1">Admins automatically have full access to all system features</p>
                            </div>
                        `;
                    }
                    
                    html += '</div>';
                    permissionsSection.innerHTML = html;
                } else {
                    permissionsSection.innerHTML = '<p class="text-gray-500 text-sm">Select a role to configure permissions</p>';
                }
            });
        }
        
        function createNewUser() {
            const name = document.getElementById('newUserName').value.trim();
            const mobile = document.getElementById('newUserMobile').value.trim();
            const password = document.getElementById('newUserPassword').value.trim();
            const role = document.getElementById('newUserRole').value;
            const department = document.getElementById('newUserDepartment').value;
            const status = document.getElementById('newUserStatus').value;
            
            // Validate mobile number starts with 7292
            if (!mobile.startsWith('7292') || mobile.length !== 10) {
                showNotification('Mobile number must start with 7292 and be 10 digits long', 'error');
                return;
            }
            
            // Check if mobile already exists
            if (users.find(u => u.mobile === mobile)) {
                showNotification('Mobile number already exists!', 'error');
                return;
            }
            
            // Get selected permissions
            const permissionCheckboxes = document.querySelectorAll('input[name="permissions"]:checked');
            const selectedPermissions = Array.from(permissionCheckboxes).map(cb => cb.value);
            
            // For admin role, always include all permissions
            const userPermissions = role === 'admin' ? 
                ['all', 'manage_users', 'view_all', 'manage_production', 'manage_workflow', 'create_orders', 'approve_orders', 'quality_check', 'approve_quality', 'update_status'] :
                selectedPermissions;
            
            // Create new user
            const newUser = {
                id: 'user_' + (users.length + 1),
                name: name,
                mobile: mobile,
                password: password,
                role: role,
                department: department,
                status: status,
                permissions: userPermissions,
                createdDate: new Date().toLocaleDateString()
            };
            
            users.push(newUser);
            
            showNotification(`User ${name} created successfully!`, 'success');
            closeAddUserModal();
            updateUsersSection();
        }
        
        function updateUsersSection() {
            // Update user statistics
            const totalUsers = users.length;
            const adminCount = users.filter(u => u.role === 'admin').length;
            const managerCount = users.filter(u => u.role === 'manager').length;
            const staffCount = users.filter(u => u.role === 'operator' || u.role === 'qc').length;
            
            document.getElementById('totalUsers').textContent = totalUsers;
            document.getElementById('adminCount').textContent = adminCount;
            document.getElementById('managerCount').textContent = managerCount;
            document.getElementById('staffCount').textContent = staffCount;
            
            // Update users list
            const usersList = document.getElementById('usersList');
            
            if (users.length === 1) {
                // Show only admin user with option to add more
                usersList.innerHTML = `
                    <div class="text-center py-12">
                        <div class="w-16 h-16 bg-gradient-to-r from-blue-100 to-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="text-blue-600 text-2xl">ğŸ‘¥</span>
                        </div>
                        <p class="text-gray-500 text-lg font-medium">Only admin user exists</p>
                        <p class="text-gray-400 text-sm mt-1">Add team members to get started!</p>
                        <button onclick="showAddUserModal()" class="mt-4 px-6 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all transform hover:scale-105">â• Add First Team Member</button>
                    </div>
                `;
                return;
            }
            
            let html = '<div class="space-y-4">';
            
            users.forEach(user => {
                const roleInfo = userRoles[user.role];
                const statusClass = user.status === 'active' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800';
                const roleIcon = user.role === 'admin' ? 'ğŸ”‘' : user.role === 'manager' ? 'ğŸ‘¨â€ğŸ’¼' : user.role === 'operator' ? 'âš™ï¸' : 'ğŸ”';
                
                // Get user's actual permissions (custom or default)
                const userPermissions = user.permissions || roleInfo.permissions;
                const permissionCount = userPermissions.includes('all') ? 'All' : userPermissions.length;
                
                html += `
                    <div class="border border-gray-200 rounded-xl p-6 hover:shadow-lg transition-all transform hover:scale-105 bg-white/50">
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex items-center space-x-4">
                                <div class="w-12 h-12 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-full flex items-center justify-center text-lg font-medium">
                                    ${user.name.split(' ').map(n => n[0]).join('').toUpperCase()}
                                </div>
                                <div>
                                    <h4 class="text-lg font-semibold text-gray-900">${user.name}</h4>
                                    <p class="text-sm text-gray-600">${user.mobile}</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <span class="px-3 py-1 text-xs rounded-full ${statusClass}">${user.status.toUpperCase()}</span>
                                <p class="text-xs text-gray-500 mt-1">Created: ${user.createdDate}</p>
                            </div>
                        </div>
                        <div class="grid md:grid-cols-3 gap-4 mb-4">
                            <div class="bg-blue-50 rounded-lg p-3">
                                <h5 class="font-medium text-blue-900 mb-1">${roleIcon} Role</h5>
                                <p class="text-sm text-blue-700">${roleInfo.name}</p>
                            </div>
                            <div class="bg-green-50 rounded-lg p-3">
                                <h5 class="font-medium text-green-900 mb-1">ğŸ¢ Department</h5>
                                <p class="text-sm text-green-700">${user.department}</p>
                            </div>
                            <div class="bg-purple-50 rounded-lg p-3">
                                <h5 class="font-medium text-purple-900 mb-1">ğŸ” Permissions</h5>
                                <p class="text-sm text-purple-700">${permissionCount} permissions</p>
                            </div>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-3">
                            <h5 class="font-medium text-gray-900 mb-2">ğŸ“‹ Active Permissions</h5>
                            <div class="flex flex-wrap gap-2">
                                ${userPermissions.slice(0, 6).map(perm => {
                                    const permName = perm.replace('_', ' ').replace('all', 'Full Access');
                                    return `<span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded">${permName}</span>`;
                                }).join('')}
                                ${userPermissions.length > 6 ? `<span class="px-2 py-1 bg-gray-200 text-gray-600 text-xs rounded">+${userPermissions.length - 6} more</span>` : ''}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            usersList.innerHTML = html;
        }
        
        // Global functions
        window.showDemoCredentials = function() {
            document.getElementById('demoCredentialsModal').classList.remove('hidden');
            document.getElementById('demoCredentialsModal').classList.add('flex');
        }
        
        window.closeDemoCredentials = function() {
            document.getElementById('demoCredentialsModal').classList.add('hidden');
            document.getElementById('demoCredentialsModal').classList.remove('flex');
        }
        
        window.fillDemoCredentials = function(type) {
            const credentials = {
                admin: { mobile: '9876543210', password: 'admin123' }
            };
            
            if (credentials[type]) {
                document.getElementById('mobileNumber').value = credentials[type].mobile;
                document.getElementById('password').value = credentials[type].password;
            }
            
            closeDemoCredentials();
        }
        
        window.toggleUserMenu = function() {
            const menu = document.getElementById('userMenu');
            menu.classList.toggle('hidden');
        }
        
        window.logout = function() {
            showNotification('Logged out successfully', 'info');
            setTimeout(() => {
                currentUser = null;
                location.reload();
            }, 1000);
        }
        
        window.showSection = function(section) {
            // Check permissions
            if (!canAccessSection(section)) {
                showNotification('Access denied. You do not have permission to view this section.', 'error');
                return;
            }
            
            // Hide all sections
            const sections = ['dashboard', 'analytics', 'production', 'workflow', 'orders', 'newOrder', 'users'];
            sections.forEach(s => {
                const element = document.getElementById(s + 'Section');
                if (element) {
                    element.classList.add('hidden');
                }
            });
            
            // Reset all navigation button styles
            const navButtons = document.querySelectorAll('.nav-btn');
            navButtons.forEach(btn => {
                btn.className = 'nav-btn px-4 py-2 text-gray-600 hover:bg-white/50 rounded-lg text-sm transition-all';
            });
            
            // Show selected section and highlight button
            const targetSection = document.getElementById(section + 'Section');
            const targetButton = document.getElementById(section + 'Btn');
            
            if (targetSection) {
                targetSection.classList.remove('hidden');
            }
            
            if (targetButton) {
                targetButton.className = 'nav-btn px-4 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 text-sm transition-all transform hover:scale-105';
            }
            
            // Update section-specific data
            if (section === 'dashboard') {
                updateDashboard();
            } else if (section === 'newOrder') {
                generateOrderId();
                setupOrderForm();
            } else if (section === 'orders') {
                filterOrders('all');
            } else if (section === 'production') {
                updateProductionSection();
            } else if (section === 'workflow') {
                updateWorkflowSection();
            } else if (section === 'users') {
                updateUsersSection();
            }
        }
        
        // Dashboard functions
        function updateDashboard() {
            const totalOrders = orders.length;
            const inProduction = orders.filter(o => o.status === 'production').length;
            const completed = orders.filter(o => o.status === 'complete').length;
            
            document.getElementById('totalOrders').textContent = totalOrders;
            document.getElementById('inProductionCount').textContent = inProduction;
            document.getElementById('completedCount').textContent = completed;
            
            // Update today's stats
            const today = new Date().toLocaleDateString();
            const todayOrders = orders.filter(o => o.createdDate === today).length;
            const todayCompleted = orders.filter(o => o.status === 'complete' && o.createdDate === today).length;
            
            document.getElementById('todayOrders').textContent = todayOrders;
            document.getElementById('todayCompleted').textContent = todayCompleted;
            document.getElementById('todayProductionTime').textContent = '0h';
            
            updateRecentOrders();
        }
        
        function updateRecentOrders() {
            const recentOrdersList = document.getElementById('recentOrdersList');
            
            if (orders.length === 0) {
                recentOrdersList.innerHTML = `
                    <div class="text-center py-12">
                        <div class="w-16 h-16 bg-gradient-to-r from-blue-100 to-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="text-blue-600 text-2xl">ğŸ“‹</span>
                        </div>
                        <p class="text-gray-500 text-lg font-medium">No orders yet</p>
                        <p class="text-gray-400 text-sm mt-1">Create your first order to get started!</p>
                        <button onclick="showSection('newOrder')" class="mt-4 px-6 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all transform hover:scale-105">â• Create First Order</button>
                    </div>
                `;
                return;
            }
            
            const recentOrders = orders.slice(-5).reverse();
            
            let html = '<div class="space-y-4">';
            recentOrders.forEach(order => {
                const statusClass = getStatusClass(order.status);
                html += `
                    <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-all transform hover:scale-105">
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <h4 class="font-semibold text-gray-900">${order.id}</h4>
                                <p class="text-sm text-gray-600">${order.customerName}</p>
                            </div>
                            <div class="text-right">
                                <span class="px-3 py-1 text-xs rounded-full ${statusClass}">${order.status.replace('-', ' ').toUpperCase()}</span>
                                <p class="text-xs text-gray-500 mt-1">${order.createdDate}</p>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div>
                                <span class="text-gray-600">Design:</span> ${order.designNumber}
                            </div>
                            <div>
                                <span class="text-gray-600">Meters:</span> ${order.metersCount}m
                            </div>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            
            recentOrdersList.innerHTML = html;
        }
        
        // Update production section
        function updateProductionSection() {
            updateMachineStatus();
            updateProductionEstimates();
        }
        
        function updateMachineStatus() {
            const machineStatusList = document.getElementById('machineStatusList');
            
            // Get all unique machines from orders
            const machines = [...new Set(orders.map(o => o.assignedMachine))];
            
            if (machines.length === 0) {
                machineStatusList.innerHTML = `
                    <div class="text-center py-8">
                        <div class="w-12 h-12 bg-gradient-to-r from-blue-100 to-indigo-100 rounded-full flex items-center justify-center mx-auto mb-3">
                            <span class="text-blue-600 text-xl">ğŸ­</span>
                        </div>
                        <p class="text-gray-500 font-medium">No machines assigned yet</p>
                        <p class="text-gray-400 text-sm mt-1">Create orders to see machine status</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            machines.forEach(machine => {
                const machineOrders = orders.filter(o => o.assignedMachine === machine);
                const activeOrders = machineOrders.filter(o => o.status === 'production').length;
                const totalOrders = machineOrders.length;
                const completedOrders = machineOrders.filter(o => o.status === 'complete').length;
                
                // Calculate efficiency based on completed vs total orders
                let efficiency = 0;
                let status = 'Ready';
                let statusClass = 'bg-green-100 text-green-800';
                
                if (totalOrders > 0) {
                    efficiency = Math.round((completedOrders / totalOrders) * 100);
                    
                    if (activeOrders > 0) {
                        status = 'In Production';
                        statusClass = 'bg-blue-100 text-blue-800';
                    } else if (completedOrders === totalOrders) {
                        status = 'Complete';
                        statusClass = 'bg-green-100 text-green-800';
                    } else {
                        status = 'Idle';
                        statusClass = 'bg-yellow-100 text-yellow-800';
                    }
                }
                
                html += `
                    <div class="flex justify-between items-center p-4 border border-gray-200 rounded-lg hover:shadow-md transition-all">
                        <div>
                            <h4 class="font-medium text-sm">${machine}</h4>
                            <p class="text-xs text-gray-600">Efficiency: ${efficiency}% (${completedOrders}/${totalOrders})</p>
                            <p class="text-xs text-gray-500">Active Orders: ${activeOrders}</p>
                        </div>
                        <span class="px-3 py-1 text-xs rounded-full ${statusClass}">${status}</span>
                    </div>
                `;
            });
            
            machineStatusList.innerHTML = html;
        }
        
        function updateProductionEstimates() {
            const productionEstimates = document.getElementById('productionEstimates');
            
            const pendingOrders = orders.filter(o => o.status === 'pending-approval' || o.status === 'production').length;
            const totalMeters = orders.filter(o => o.status !== 'complete').reduce((sum, o) => sum + o.metersCount, 0);
            const completedOrders = orders.filter(o => o.status === 'complete').length;
            const totalOrders = orders.length;
            
            // Calculate capacity usage
            const maxCapacity = 100; // Assume 100 orders max capacity
            const capacityUsage = totalOrders > 0 ? Math.round((totalOrders / maxCapacity) * 100) : 0;
            
            // Calculate estimated completion
            let estimatedCompletion = 'No pending orders';
            if (pendingOrders > 0) {
                const avgDaysPerOrder = 3; // Assume 3 days per order
                const estimatedDays = Math.ceil(pendingOrders * avgDaysPerOrder / 3); // Assuming 3 machines
                const completionDate = new Date();
                completionDate.setDate(completionDate.getDate() + estimatedDays);
                estimatedCompletion = completionDate.toLocaleDateString();
            }
            
            productionEstimates.innerHTML = `
                <div class="flex justify-between p-3 bg-gray-50 rounded-lg">
                    <span class="text-sm text-gray-600">Pending Orders:</span>
                    <span class="font-medium">${pendingOrders}</span>
                </div>
                <div class="flex justify-between p-3 bg-gray-50 rounded-lg">
                    <span class="text-sm text-gray-600">Remaining Meters:</span>
                    <span class="font-medium">${totalMeters}m</span>
                </div>
                <div class="flex justify-between p-3 bg-gray-50 rounded-lg">
                    <span class="text-sm text-gray-600">Est. Completion:</span>
                    <span class="font-medium text-green-600">${estimatedCompletion}</span>
                </div>
                <div class="flex justify-between p-3 bg-gray-50 rounded-lg">
                    <span class="text-sm text-gray-600">Capacity Usage:</span>
                    <span class="font-medium text-blue-600">${capacityUsage}%</span>
                </div>
                <div class="flex justify-between p-3 bg-gray-50 rounded-lg">
                    <span class="text-sm text-gray-600">Completed Orders:</span>
                    <span class="font-medium text-purple-600">${completedOrders}/${totalOrders}</span>
                </div>
            `;
        }
        
        // Update workflow section
        function updateWorkflowSection() {
            const pending = orders.filter(o => o.status === 'pending-approval').length;
            const approved = orders.filter(o => o.status === 'production').length;
            const quality = orders.filter(o => o.status === 'quality-check').length;
            const complete = orders.filter(o => o.status === 'complete').length;
            
            document.getElementById('workflowPending').textContent = pending;
            document.getElementById('workflowApproved').textContent = approved;
            document.getElementById('workflowQuality').textContent = quality;
            document.getElementById('workflowComplete').textContent = complete;
            
            // Update workflow orders list
            const workflowList = document.getElementById('workflowOrdersList');
            if (orders.length === 0) {
                workflowList.innerHTML = `
                    <div class="text-center py-12">
                        <div class="w-16 h-16 bg-gradient-to-r from-blue-100 to-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="text-blue-600 text-2xl">ğŸ”„</span>
                        </div>
                        <p class="text-gray-500 text-lg font-medium">No orders in workflow yet</p>
                        <p class="text-gray-400 text-sm mt-1">Create your first order to see it here!</p>
                        <button onclick="showSection('newOrder')" class="mt-4 px-6 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all transform hover:scale-105">â• Create First Order</button>
                    </div>
                `;
            } else {
                let html = '<div class="space-y-4">';
                orders.slice(-5).reverse().forEach(order => {
                    const statusClass = getStatusClass(order.status);
                    html += `
                        <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-all transform hover:scale-105">
                            <div class="flex justify-between items-start">
                                <div>
                                    <h4 class="font-semibold text-gray-900">${order.id}</h4>
                                    <p class="text-sm text-gray-600">${order.customerName}</p>
                                    <p class="text-xs text-gray-500">Created: ${order.createdDate}</p>
                                </div>
                                <span class="px-3 py-1 text-xs rounded-full ${statusClass}">${order.status.replace('-', ' ').toUpperCase()}</span>
                            </div>
                        </div>
                    `;
                });
                html += '</div>';
                workflowList.innerHTML = html;
            }
        }
        
        // Order management functions
        function generateOrderId() {
            const today = new Date();
            const year = today.getFullYear().toString().slice(-2);
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            const dateKey = year + month + day;
            
            if (!dailyCounter[dateKey]) {
                dailyCounter[dateKey] = 1;
            }
            
            const orderNumber = String(dailyCounter[dateKey]).padStart(2, '0');
            const orderId = dateKey + orderNumber;
            
            const orderIdField = document.getElementById('orderId');
            if (orderIdField) {
                orderIdField.value = orderId;
            }
        }
        
        function setupOrderForm() {
            const orderForm = document.getElementById('orderForm');
            if (orderForm) {
                // Remove existing event listeners
                const newForm = orderForm.cloneNode(true);
                orderForm.parentNode.replaceChild(newForm, orderForm);
                
                newForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    createOrder();
                });
            }
            
            // Setup add user form
            const addUserForm = document.getElementById('addUserForm');
            if (addUserForm) {
                const newAddUserForm = addUserForm.cloneNode(true);
                addUserForm.parentNode.replaceChild(newAddUserForm, addUserForm);
                
                newAddUserForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    createNewUser();
                });
            }
        }
        
        function createOrder() {
            const orderId = document.getElementById('orderId').value;
            
            // Check if order ID already exists
            if (orders.find(o => o.id === orderId)) {
                showNotification('Order ID already exists! Please refresh to get a new ID.', 'error');
                return;
            }
            
            // Get assigned machine (now required)
            const assignedMachine = document.getElementById('assignedMachine').value;
            if (!assignedMachine) {
                showNotification('Please select an assigned machine', 'error');
                return;
            }
            
            // Get design image if uploaded
            const designImageInput = document.getElementById('designImage');
            let designImage = '';
            if (designImageInput.files[0]) {
                const previewImg = document.getElementById('previewImg');
                designImage = previewImg.src;
            }
            
            // Get embroidery placement (handle custom placement)
            const placementSelect = document.getElementById('embroideryPlacement');
            let embroideryPlacement = placementSelect.value;
            
            if (embroideryPlacement === 'custom') {
                const customPlacement = document.getElementById('customPlacement').value.trim();
                if (!customPlacement) {
                    showNotification('Please enter custom placement details', 'error');
                    return;
                }
                embroideryPlacement = customPlacement;
            }
            
            // Calculate estimated completion date
            const estimatedDays = 3; // Default 3 days
            const completionDate = new Date();
            completionDate.setDate(completionDate.getDate() + estimatedDays);
            
            const order = {
                id: orderId,
                customerName: document.getElementById('customerName').value,
                designNumber: document.getElementById('designNumber').value,
                fabricType: document.getElementById('fabricType').value,
                fabricColor: document.getElementById('fabricColor').value,
                metersCount: parseInt(document.getElementById('metersCount').value),
                embroideryPlacement: embroideryPlacement,
                repeatSize: document.getElementById('repeatSize').value,
                yarnCode: document.getElementById('yarnCode').value,
                assignedMachine: assignedMachine,
                designImage: designImage,
                status: 'pending-approval',
                workflowStage: 'pending-approval',
                priority: 'normal',
                estimatedCompletion: completionDate.toLocaleDateString(),
                createdDate: new Date().toLocaleDateString(),
                createdTime: new Date().toLocaleTimeString(),
                productionTime: 0,
                qualityChecks: [],
                approvedBy: null,
                approvedDate: null
            };
            
            orders.push(order);
            
            // Update daily counter
            const today = new Date();
            const year = today.getFullYear().toString().slice(-2);
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            const dateKey = year + month + day;
            dailyCounter[dateKey]++;
            
            showNotification('Order created successfully and sent for approval!', 'success');
            
            resetOrderForm();
            generateOrderId();
            updateDashboard();
            updateProductionSection();
        }
        
        window.resetOrderForm = function() {
            const orderForm = document.getElementById('orderForm');
            if (orderForm) {
                orderForm.reset();
                // Hide image preview
                document.getElementById('imagePreview').classList.add('hidden');
                // Hide custom placement field
                document.getElementById('customPlacementDiv').classList.add('hidden');
                document.getElementById('customPlacement').required = false;
                generateOrderId();
                showNotification('Form reset successfully', 'info');
            }
        }
        
        // Orders section functions
        window.filterOrders = function(status) {
            // Update filter button styles
            document.querySelectorAll('[id^="filter"]').forEach(btn => {
                btn.className = 'px-4 py-2 bg-white/80 text-gray-700 rounded-lg hover:bg-white border border-gray-200 text-sm transition-all';
            });
            
            const activeBtn = document.getElementById('filter' + status.charAt(0).toUpperCase() + status.slice(1).replace('-', ''));
            if (activeBtn) {
                activeBtn.className = 'px-4 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 text-sm transition-all transform hover:scale-105';
            }
            
            let filteredOrders = orders;
            if (status !== 'all') {
                filteredOrders = orders.filter(o => o.status === status);
            }
            
            displayOrdersList(filteredOrders);
        }
        
        function displayOrdersList(orderList) {
            const ordersList = document.getElementById('ordersList');
            
            if (orderList.length === 0) {
                ordersList.innerHTML = `
                    <div class="text-center py-12">
                        <div class="w-16 h-16 bg-gradient-to-r from-blue-100 to-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="text-blue-600 text-2xl">ğŸ“‹</span>
                        </div>
                        <p class="text-gray-500 text-lg font-medium">No orders found</p>
                        <p class="text-gray-400 text-sm mt-1">Create your first order to get started!</p>
                        <button onclick="showSection('newOrder')" class="mt-4 px-6 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all transform hover:scale-105">â• Create First Order</button>
                    </div>
                `;
                return;
            }
            
            let html = '<div class="space-y-6">';
            orderList.forEach(order => {
                const statusClass = getStatusClass(order.status);
                html += `
                    <div class="border border-gray-200 rounded-xl p-6 hover:shadow-lg transition-all transform hover:scale-105 bg-white/50">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h4 class="text-xl font-semibold text-gray-900">${order.id}</h4>
                                <p class="text-gray-600 font-medium">${order.customerName}</p>
                            </div>
                            <div class="text-right">
                                <span class="px-4 py-2 text-sm rounded-full ${statusClass}">${order.status.replace('-', ' ').toUpperCase()}</span>
                                <p class="text-sm text-gray-500 mt-1">Created: ${order.createdDate}</p>
                            </div>
                        </div>
                        <div class="grid md:grid-cols-3 gap-6 mb-4">
                            <div class="bg-blue-50 rounded-lg p-4">
                                <h5 class="font-medium text-blue-900 mb-2">ğŸ“‹ Order Details</h5>
                                <p class="text-sm text-blue-700">Design: ${order.designNumber}</p>
                                <p class="text-sm text-blue-700">Meters: ${order.metersCount}m</p>
                                <p class="text-sm text-blue-700">Repeat Size: ${order.repeatSize || 'N/A'}</p>
                            </div>
                            <div class="bg-green-50 rounded-lg p-4">
                                <h5 class="font-medium text-green-900 mb-2">ğŸ§µ Fabric Details</h5>
                                <p class="text-sm text-green-700">Type: ${order.fabricType}</p>
                                <p class="text-sm text-green-700">Color: ${order.fabricColor}</p>
                                <p class="text-sm text-green-700">Yarn Code: ${order.yarnCode || 'N/A'}</p>
                            </div>
                            <div class="bg-purple-50 rounded-lg p-4">
                                <h5 class="font-medium text-purple-900 mb-2">âš™ï¸ Production</h5>
                                <p class="text-sm text-purple-700">Machine: ${order.assignedMachine}</p>
                                <p class="text-sm text-purple-700">Placement: ${order.embroideryPlacement}</p>
                                <p class="text-sm text-purple-700">Est. Completion: ${order.estimatedCompletion}</p>
                            </div>
                        </div>
                        <div class="flex gap-3 mt-4 pt-4 border-t border-gray-200">
                            <select onchange="updateOrderStatus('${order.id}', this.value)" class="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="">Change Status</option>
                                <option value="pending-approval" ${order.status === 'pending-approval' ? 'selected' : ''}>â³ Pending Approval</option>
                                <option value="production" ${order.status === 'production' ? 'selected' : ''}>âš™ï¸ In Production</option>
                                <option value="quality-check" ${order.status === 'quality-check' ? 'selected' : ''}>ğŸ” Quality Check</option>
                                <option value="complete" ${order.status === 'complete' ? 'selected' : ''}>âœ… Complete</option>
                            </select>
                            <button onclick="editOrder('${order.id}')" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm transition-all">âœï¸ Edit</button>
                            <button onclick="printJobCard('${order.id}')" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm transition-all">ğŸ–¨ï¸ Job Card</button>
                            <button onclick="deleteOrder('${order.id}')" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 text-sm transition-all">ğŸ—‘ï¸ Delete</button>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            
            ordersList.innerHTML = html;
        }
        
        function getStatusClass(status) {
            switch(status) {
                case 'pending-approval': return 'bg-yellow-100 text-yellow-800 border border-yellow-200';
                case 'production': return 'bg-blue-100 text-blue-800 border border-blue-200';
                case 'quality-check': return 'bg-orange-100 text-orange-800 border border-orange-200';
                case 'complete': return 'bg-green-100 text-green-800 border border-green-200';
                default: return 'bg-gray-100 text-gray-800 border border-gray-200';
            }
        }
        
        // Image upload handler
        window.handleImageUpload = function(input) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('imagePreview');
                    const previewImg = document.getElementById('previewImg');
                    previewImg.src = e.target.result;
                    preview.classList.remove('hidden');
                    showNotification('Design image uploaded successfully', 'success');
                };
                reader.readAsDataURL(file);
            }
        }
        
        // Handle placement change
        window.handlePlacementChange = function() {
            const placementSelect = document.getElementById('embroideryPlacement');
            const customDiv = document.getElementById('customPlacementDiv');
            const customInput = document.getElementById('customPlacement');
            
            if (placementSelect.value === 'custom') {
                customDiv.classList.remove('hidden');
                customInput.required = true;
                customInput.focus();
            } else {
                customDiv.classList.add('hidden');
                customInput.required = false;
                customInput.value = '';
            }
        }
        
        // Setup login form
        function setupLoginForm() {
            const loginForm = document.getElementById('loginForm');
            if (loginForm) {
                loginForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const mobile = document.getElementById('mobileNumber').value.trim();
                    const password = document.getElementById('password').value.trim();
                    
                    if (!mobile || !password) {
                        showNotification('Please enter both mobile number and password', 'error');
                        return;
                    }
                    
                    if (authenticateUser(mobile, password)) {
                        // Hide login modal
                        document.getElementById('loginModal').classList.add('hidden');
                        document.getElementById('loginModal').classList.remove('flex');
                        
                        // Update UI and show dashboard
                        updateUserInterface();
                        updateDashboard();
                        showSection('dashboard');
                        
                        showNotification(`Welcome to Version 21, ${currentUser.name}!`, 'success');
                    } else {
                        showNotification('Invalid mobile number or password!', 'error');
                    }
                });
            }
        }
        
        // Initialize the application
        function initializeApp() {
            console.log('Initializing Schiffli Production Manager v21...');
            
            // Setup login form
            setupLoginForm();
            
            // Setup edit order form
            setupEditOrderForm();
            
            // Update date/time every minute
            updateDateTime();
            setInterval(updateDateTime, 60000);
            
            // Show login modal
            document.getElementById('loginModal').classList.remove('hidden');
            document.getElementById('loginModal').classList.add('flex');
            
            console.log('App v21 initialized successfully');
        }
        
        // Start the application when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, starting app v21...');
            initializeApp();
        });
        
        // Order Management Functions
        window.updateOrderStatus = function(orderId, newStatus) {
            if (!newStatus) return;
            
            const order = orders.find(o => o.id === orderId);
            if (!order) {
                showNotification('Order not found!', 'error');
                return;
            }
            
            const oldStatus = order.status;
            order.status = newStatus;
            order.workflowStage = newStatus;
            
            // Update timestamps based on status
            const now = new Date();
            if (newStatus === 'production' && oldStatus === 'pending-approval') {
                order.approvedDate = now.toLocaleDateString();
                order.approvedBy = currentUser.name;
            } else if (newStatus === 'complete') {
                order.completedDate = now.toLocaleDateString();
                order.completedTime = now.toLocaleTimeString();
            }
            
            showNotification(`Order ${orderId} status updated to ${newStatus.replace('-', ' ').toUpperCase()}`, 'success');
            
            // Refresh current view
            const currentFilter = document.querySelector('[id^="filter"].bg-gradient-to-r');
            if (currentFilter) {
                const filterType = currentFilter.id.replace('filter', '').toLowerCase();
                if (filterType === 'all') {
                    filterOrders('all');
                } else {
                    filterOrders(filterType.replace('pending', 'pending-approval').replace('quality', 'quality-check'));
                }
            }
            
            updateDashboard();
            updateProductionSection();
            updateWorkflowSection();
        }
        
        window.editOrder = function(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) {
                showNotification('Order not found!', 'error');
                return;
            }
            
            // Populate edit form
            document.getElementById('editOrderId').value = order.id;
            document.getElementById('editCustomerName').value = order.customerName;
            document.getElementById('editDesignNumber').value = order.designNumber;
            document.getElementById('editMetersCount').value = order.metersCount;
            document.getElementById('editFabricType').value = order.fabricType;
            document.getElementById('editFabricColor').value = order.fabricColor;
            document.getElementById('editRepeatSize').value = order.repeatSize || '';
            document.getElementById('editYarnCode').value = order.yarnCode || '';
            document.getElementById('editAssignedMachine').value = order.assignedMachine;
            
            // Handle embroidery placement
            const standardPlacements = ['Front', 'Back', 'Sleeve', 'Chest', 'All-Over', 'Collar', 'Pocket', 'Hem'];
            if (standardPlacements.includes(order.embroideryPlacement)) {
                document.getElementById('editEmbroideryPlacement').value = order.embroideryPlacement;
            } else {
                document.getElementById('editEmbroideryPlacement').value = 'custom';
                document.getElementById('editCustomPlacementDiv').classList.remove('hidden');
                document.getElementById('editCustomPlacement').value = order.embroideryPlacement;
                document.getElementById('editCustomPlacement').required = true;
            }
            
            // Show modal
            document.getElementById('editOrderModal').classList.remove('hidden');
            document.getElementById('editOrderModal').classList.add('flex');
        }
        
        window.closeEditOrderModal = function() {
            document.getElementById('editOrderModal').classList.add('hidden');
            document.getElementById('editOrderModal').classList.remove('flex');
            document.getElementById('editOrderForm').reset();
            document.getElementById('editCustomPlacementDiv').classList.add('hidden');
            document.getElementById('editCustomPlacement').required = false;
        }
        
        window.handleEditPlacementChange = function() {
            const placementSelect = document.getElementById('editEmbroideryPlacement');
            const customDiv = document.getElementById('editCustomPlacementDiv');
            const customInput = document.getElementById('editCustomPlacement');
            
            if (placementSelect.value === 'custom') {
                customDiv.classList.remove('hidden');
                customInput.required = true;
                customInput.focus();
            } else {
                customDiv.classList.add('hidden');
                customInput.required = false;
                customInput.value = '';
            }
        }
        
        function updateOrder() {
            const orderId = document.getElementById('editOrderId').value;
            const order = orders.find(o => o.id === orderId);
            
            if (!order) {
                showNotification('Order not found!', 'error');
                return;
            }
            
            // Get embroidery placement (handle custom placement)
            const placementSelect = document.getElementById('editEmbroideryPlacement');
            let embroideryPlacement = placementSelect.value;
            
            if (embroideryPlacement === 'custom') {
                const customPlacement = document.getElementById('editCustomPlacement').value.trim();
                if (!customPlacement) {
                    showNotification('Please enter custom placement details', 'error');
                    return;
                }
                embroideryPlacement = customPlacement;
            }
            
            // Update order
            order.customerName = document.getElementById('editCustomerName').value;
            order.designNumber = document.getElementById('editDesignNumber').value;
            order.metersCount = parseInt(document.getElementById('editMetersCount').value);
            order.fabricType = document.getElementById('editFabricType').value;
            order.fabricColor = document.getElementById('editFabricColor').value;
            order.embroideryPlacement = embroideryPlacement;
            order.repeatSize = document.getElementById('editRepeatSize').value;
            order.yarnCode = document.getElementById('editYarnCode').value;
            order.assignedMachine = document.getElementById('editAssignedMachine').value;
            order.lastModified = new Date().toLocaleDateString();
            order.modifiedBy = currentUser.name;
            
            showNotification(`Order ${orderId} updated successfully!`, 'success');
            closeEditOrderModal();
            
            // Refresh current view
            const currentFilter = document.querySelector('[id^="filter"].bg-gradient-to-r');
            if (currentFilter) {
                const filterType = currentFilter.id.replace('filter', '').toLowerCase();
                if (filterType === 'all') {
                    filterOrders('all');
                } else {
                    filterOrders(filterType.replace('pending', 'pending-approval').replace('quality', 'quality-check'));
                }
            }
            
            updateDashboard();
        }
        
        window.deleteOrder = function(orderId) {
            if (!confirm(`Are you sure you want to delete order ${orderId}? This action cannot be undone.`)) {
                return;
            }
            
            const orderIndex = orders.findIndex(o => o.id === orderId);
            if (orderIndex === -1) {
                showNotification('Order not found!', 'error');
                return;
            }
            
            orders.splice(orderIndex, 1);
            showNotification(`Order ${orderId} deleted successfully!`, 'success');
            
            // Refresh current view
            const currentFilter = document.querySelector('[id^="filter"].bg-gradient-to-r');
            if (currentFilter) {
                const filterType = currentFilter.id.replace('filter', '').toLowerCase();
                if (filterType === 'all') {
                    filterOrders('all');
                } else {
                    filterOrders(filterType.replace('pending', 'pending-approval').replace('quality', 'quality-check'));
                }
            }
            
            updateDashboard();
            updateProductionSection();
            updateWorkflowSection();
        }
        
        window.printJobCard = function(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) {
                showNotification('Order not found!', 'error');
                return;
            }
            
            generateJobCard(order);
            document.getElementById('jobCardModal').classList.remove('hidden');
            document.getElementById('jobCardModal').classList.add('flex');
            showNotification('Job card preview loaded successfully!', 'success');
        }
        
        window.closeJobCardModal = function() {
            document.getElementById('jobCardModal').classList.add('hidden');
            document.getElementById('jobCardModal').classList.remove('flex');
        }
        
        function generateJobCard(order) {
            const jobCardContent = document.getElementById('jobCardContent');
            const currentDate = new Date().toLocaleDateString();
            const currentTime = new Date().toLocaleTimeString();
            
            // Create redesigned A4 job card layout with larger design image
            jobCardContent.innerHTML = `
                <!-- Header -->
                <div style="text-align: center; margin-bottom: 15mm; border-bottom: 3px solid #2563eb; padding-bottom: 8mm;">
                    <h1 style="font-size: 32px; font-weight: bold; color: #1e40af; margin: 0; margin-bottom: 5px;">SCHIFFLI PRODUCTION</h1>
                    <h2 style="font-size: 28px; font-weight: bold; color: #374151; margin: 0; margin-bottom: 5px;">JOB CARD</h2>
                    <p style="font-size: 16px; color: #6b7280; margin: 0;">Production Order: <strong style="color: #1e40af; font-size: 18px;">${order.id}</strong></p>
                </div>
                
                <!-- Main Content Layout -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15mm; margin-bottom: 15mm;">
                    <!-- Left Column - Order Information -->
                    <div>
                        <!-- Order Details -->
                        <div style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); padding: 8mm; border-radius: 8px; margin-bottom: 8mm;">
                            <h3 style="font-size: 16px; font-weight: bold; color: #1e40af; margin: 0 0 5mm 0; border-bottom: 1px solid #93c5fd; padding-bottom: 3mm;">ğŸ“‹ ORDER DETAILS</h3>
                            <div style="font-size: 13px; line-height: 1.6;">
                                <div style="margin-bottom: 3mm;"><strong>Customer:</strong> ${order.customerName}</div>
                                <div style="margin-bottom: 3mm;"><strong>Date Created:</strong> ${order.createdDate}</div>
                                <div style="margin-bottom: 3mm;"><strong>Status:</strong> <span style="color: #059669; font-weight: bold;">${order.status.replace('-', ' ').toUpperCase()}</span></div>
                                <div><strong>Est. Completion:</strong> ${order.estimatedCompletion}</div>
                            </div>
                        </div>
                        
                        <!-- Design Specifications -->
                        <div style="background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%); padding: 8mm; border-radius: 8px; margin-bottom: 8mm;">
                            <h3 style="font-size: 16px; font-weight: bold; color: #059669; margin: 0 0 5mm 0; border-bottom: 1px solid #86efac; padding-bottom: 3mm;">ğŸ¨ DESIGN SPECS</h3>
                            <div style="font-size: 13px; line-height: 1.6;">
                                <div style="margin-bottom: 3mm;"><strong>Design Number:</strong> <span style="color: #059669; font-weight: bold;">${order.designNumber}</span></div>
                                <div style="margin-bottom: 3mm;"><strong>Meters to Produce:</strong> <span style="color: #059669; font-weight: bold; font-size: 15px;">${order.metersCount}m</span></div>
                                <div style="margin-bottom: 3mm;"><strong>Repeat Size:</strong> ${order.repeatSize || 'N/A'}</div>
                                <div><strong>Placement:</strong> ${order.embroideryPlacement}</div>
                            </div>
                        </div>
                        
                        <!-- Fabric & Materials -->
                        <div style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); padding: 8mm; border-radius: 8px; margin-bottom: 8mm;">
                            <h3 style="font-size: 16px; font-weight: bold; color: #d97706; margin: 0 0 5mm 0; border-bottom: 1px solid #fcd34d; padding-bottom: 3mm;">ğŸ§µ MATERIALS</h3>
                            <div style="font-size: 13px; line-height: 1.6;">
                                <div style="margin-bottom: 3mm;"><strong>Fabric Type:</strong> ${order.fabricType}</div>
                                <div style="margin-bottom: 3mm;"><strong>Fabric Color:</strong> ${order.fabricColor}</div>
                                <div style="margin-bottom: 3mm;"><strong>Yarn Code:</strong> ${order.yarnCode || 'N/A'}</div>
                                <div><strong>Machine:</strong> <span style="color: #d97706; font-weight: bold;">${order.assignedMachine}</span></div>
                            </div>
                        </div>
                        
                        <!-- Quality Checkpoints -->
                        <div style="background: #f9fafb; border: 2px dashed #d1d5db; padding: 8mm; border-radius: 8px;">
                            <h3 style="font-size: 14px; font-weight: bold; color: #374151; margin: 0 0 5mm 0;">âœ… QUALITY CHECKS</h3>
                            <div style="font-size: 11px; line-height: 1.4;">
                                <div style="display: flex; align-items: center; margin-bottom: 2mm;">
                                    <span style="width: 12px; height: 12px; border: 2px solid #6b7280; margin-right: 3mm; display: inline-block;"></span>
                                    <span>Design Alignment</span>
                                </div>
                                <div style="display: flex; align-items: center; margin-bottom: 2mm;">
                                    <span style="width: 12px; height: 12px; border: 2px solid #6b7280; margin-right: 3mm; display: inline-block;"></span>
                                    <span>Thread Tension</span>
                                </div>
                                <div style="display: flex; align-items: center; margin-bottom: 2mm;">
                                    <span style="width: 12px; height: 12px; border: 2px solid #6b7280; margin-right: 3mm; display: inline-block;"></span>
                                    <span>Color Matching</span>
                                </div>
                                <div style="display: flex; align-items: center; margin-bottom: 2mm;">
                                    <span style="width: 12px; height: 12px; border: 2px solid #6b7280; margin-right: 3mm; display: inline-block;"></span>
                                    <span>Fabric Quality</span>
                                </div>
                                <div style="display: flex; align-items: center; margin-bottom: 2mm;">
                                    <span style="width: 12px; height: 12px; border: 2px solid #6b7280; margin-right: 3mm; display: inline-block;"></span>
                                    <span>Stitch Density</span>
                                </div>
                                <div style="display: flex; align-items: center;">
                                    <span style="width: 12px; height: 12px; border: 2px solid #6b7280; margin-right: 3mm; display: inline-block;"></span>
                                    <span>Final Inspection</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Right Column - Large Design Image -->
                    <div>
                        <div style="text-align: center; margin-bottom: 8mm;">
                            <h3 style="font-size: 18px; font-weight: bold; color: #374151; margin: 0; border-bottom: 2px solid #e5e7eb; padding-bottom: 3mm;">ğŸ¨ DESIGN REFERENCE</h3>
                        </div>
                        
                        <!-- Large Design Image Container -->
                        <div style="border: 3px solid #2563eb; border-radius: 12px; background: white; padding: 5mm; height: 180mm; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);">
                            ${order.designImage ? 
                                `<img src="${order.designImage}" alt="Design Image" style="max-width: 100%; max-height: 100%; object-fit: contain; border-radius: 8px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);">` :
                                `<div style="text-align: center; color: #9ca3af; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                                    <div style="font-size: 64px; margin-bottom: 15mm; color: #d1d5db;">ğŸ¨</div>
                                    <p style="font-size: 24px; margin: 0; font-weight: 600; color: #6b7280;">DESIGN IMAGE</p>
                                    <p style="font-size: 16px; margin: 8mm 0; color: #9ca3af;">Attach design reference here</p>
                                    <div style="background: #f3f4f6; border: 2px dashed #d1d5db; border-radius: 8px; padding: 15mm; margin-top: 10mm; max-width: 80%;">
                                        <p style="font-size: 14px; margin: 0; color: #374151; font-weight: 600;">Design: ${order.designNumber}</p>
                                        <p style="font-size: 12px; margin: 5mm 0 0 0; color: #6b7280;">Placement: ${order.embroideryPlacement}</p>
                                        <p style="font-size: 12px; margin: 3mm 0 0 0; color: #6b7280;">Repeat: ${order.repeatSize || 'N/A'}</p>
                                    </div>
                                </div>`
                            }
                        </div>
                    </div>
                </div>
                
                <!-- Bottom Section - Notes and Signatures -->
                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 15mm; margin-top: 15mm;">
                    <!-- Production Notes -->
                    <div style="border: 2px solid #e5e7eb; border-radius: 8px; padding: 8mm; background: white;">
                        <h4 style="font-size: 14px; font-weight: bold; color: #374151; margin: 0 0 5mm 0;">ğŸ“ PRODUCTION NOTES & INSTRUCTIONS</h4>
                        <div style="min-height: 25mm; border: 1px solid #e5e7eb; border-radius: 4px; padding: 5mm; background: #fafafa;">
                            <p style="font-size: 10px; color: #9ca3af; margin: 0;">Space for operator notes, special instructions, quality observations, or production remarks...</p>
                        </div>
                    </div>
                    
                    <!-- Signatures -->
                    <div>
                        <div style="margin-bottom: 8mm;">
                            <div style="border: 2px solid #374151; border-radius: 8px; padding: 8mm; text-align: center; background: #f9fafb;">
                                <p style="margin: 0; font-size: 12px; color: #374151; font-weight: bold;">OPERATOR</p>
                                <div style="height: 15mm; border-bottom: 1px solid #6b7280; margin: 5mm 0;"></div>
                                <p style="margin: 0; font-size: 10px; color: #6b7280;">Signature & Date</p>
                            </div>
                        </div>
                        
                        <div>
                            <div style="border: 2px solid #374151; border-radius: 8px; padding: 8mm; text-align: center; background: #f9fafb;">
                                <p style="margin: 0; font-size: 12px; color: #374151; font-weight: bold;">QUALITY CONTROL</p>
                                <div style="height: 15mm; border-bottom: 1px solid #6b7280; margin: 5mm 0;"></div>
                                <p style="margin: 0; font-size: 10px; color: #6b7280;">Signature & Date</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Footer -->
                <div style="text-align: center; margin-top: 15mm; padding-top: 8mm; border-top: 2px solid #e5e7eb; font-size: 10px; color: #6b7280;">
                    <p style="margin: 0; font-weight: 600;">Generated by Schiffli Production Manager v21</p>
                    <p style="margin: 2mm 0 0 0;">${currentDate} ${currentTime} | Created by: ${currentUser.name}</p>
                </div>
            `;
        }
        
        window.printJobCardNow = function() {
            // Print the job card directly
            window.print();
            showNotification('Job Card sent to printer!', 'success');
        }
        
        window.downloadJobCardPDF = function() {
            try {
                // Simple PDF generation using browser's print functionality
                const jobCardContent = document.getElementById('jobCardContent');
                const originalTitle = document.title;
                
                // Get order ID for filename
                const orderIdElement = jobCardContent.querySelector('strong[style*="color: #1e40af"]');
                const orderId = orderIdElement ? orderIdElement.textContent : 'Unknown';
                
                // Create a new window for PDF generation
                const printWindow = window.open('', '_blank');
                printWindow.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>Job Card - ${orderId}</title>
                        <style>
                            @page {
                                size: A4;
                                margin: 10mm;
                            }
                            body {
                                font-family: Arial, sans-serif;
                                margin: 0;
                                padding: 0;
                                -webkit-print-color-adjust: exact;
                                print-color-adjust: exact;
                            }
                            @media print {
                                body { margin: 0; }
                            }
                        </style>
                    </head>
                    <body>
                        ${jobCardContent.innerHTML}
                    </body>
                    </html>
                `);
                
                printWindow.document.close();
                
                // Wait for content to load then trigger print
                setTimeout(() => {
                    printWindow.focus();
                    printWindow.print();
                    
                    // Close the window after printing
                    setTimeout(() => {
                        printWindow.close();
                    }, 1000);
                }, 500);
                
                showNotification('Job Card PDF generation started! Use your browser\'s print dialog to save as PDF.', 'success');
                
            } catch (error) {
                console.error('PDF generation error:', error);
                showNotification('PDF generation failed. Please try using the Print button instead.', 'error');
            }
        }
        
        // Setup edit order form
        function setupEditOrderForm() {
            const editOrderForm = document.getElementById('editOrderForm');
            if (editOrderForm) {
                const newForm = editOrderForm.cloneNode(true);
                editOrderForm.parentNode.replaceChild(newForm, editOrderForm);
                
                newForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    updateOrder();
                });
            }
        }
        
        // Close user menu when clicking outside
        document.addEventListener('click', function(event) {
            const userMenu = document.getElementById('userMenu');
            const userButton = event.target.closest('button[onclick="toggleUserMenu()"]');
            
            if (!userButton && !userMenu.contains(event.target)) {
                userMenu.classList.add('hidden');
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'978c9ae4c0f14038',t:'MTc1NjgxMTg4OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
